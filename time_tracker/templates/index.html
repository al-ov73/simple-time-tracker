{% load django_bootstrap5 %}
{% load static %}

<!doctype html>

<html lang="en">
  <head>
      {% load static %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="generator" content="Jekyll v4.1.1">
    <title>Трекер задач</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
          rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
          crossorigin="anonymous">

  </head>
  <body>

    <main class="flex-grow-1">
      <div class="container-lg mt-3">

          <div class="row">
            <div class="col-12 col-md-10 col-lg-8 mx-auto border rounded-3 bg-light p-5">


      <form action="{% url 'index' %}" method="post">
  {% csrf_token %}
  {% bootstrap_form form %}

  <input type="submit" class="btn btn-primary mb-3" value="Создать">

</form>

<script type="text/javascript">
    
var tasks_json = JSON.parse('{{tasks_json | safe | escapejs}}');

let table = document.createElement('table');
table.classList.add('table');
table.classList.add('w-auto');

for (const task of tasks_json) {

  const row = table.insertRow(); // добавим строку

  let cell1 = row.insertCell(); // добавим ячейки
  cell1.classList.add("col-xs-5");
  let cell2 = row.insertCell();
  cell2.classList.add("col-xs-2");
  let cell3 = row.insertCell();
  var link = `${task.id}/task`;
  cell1.innerHTML = `<a href="${link}">${task.name}</a>`; // вставим текст
  cell2.innerHTML = "";
  cell2.classList.add("created");
  if (task.status === 'on_work') {
    cell3.classList.add("timer")
  } else {
    cell3.innerHTML = 'Готово!';
  }
  cell3.classList.add("col-xs-5");
}
document.body.childNodes[1].childNodes[1].childNodes[1].childNodes[1].appendChild(table);

</script>

<script>
  function secToMin(time) {
    const sec = time % 60 < 10 ? '0' + time % 60 : time % 60;

    const minutes = Math.floor(time / 60);
    return `${minutes}:${sec}`;
  };

  function calculateTimer() {
    var timers = document.getElementsByClassName("timer");
    i = 0;
    for (let timer of timers) {
      var nowtime = Date.now();
      var created_str = Date.parse(tasks_json[i].timestamp);
      var created = parseInt(created_str)
      var diff = nowtime - created;
      var totalSecs = Math.round(diff / 1000);
      timer.innerHTML = secToMin(totalSecs);
      i += 1;
    }
    setTimeout(calculateTimer, 1000);
  }
  calculateTimer();
</script>
            
</main>
    <footer>



    </footer>
<!--<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>-->
<!--      <script>window.jQuery || document.write('<script src="../assets/js/vendor/jquery.slim.min.js"><\/script>')</script><script src="../assets/dist/js/bootstrap.bundle.min.js"></script>-->
</html>
