{% load django_bootstrap5 %}
{% load static %}
{% load rest_framework %}

<!doctype html>

<html lang="en">
  <head>
      {% load static %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="generator" content="Jekyll v4.1.1">
    <title>Трекер задач</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.5/examples/jumbotron/">

    <!-- Bootstrap core CSS -->
<link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">

  </head>
  <body>

      <h1 class="my-4">
        Трекер задач
      </h1>

<h1 class="my-4"></h1>
<main role="main">
    <div class="container">

{% if messages %}
<ul class="alert alert-info alert-dismissible fade show">
    {% for message in messages %}
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    {% endfor %}
</ul>
{% endif %}


  {% if form.errors %}
    <div>
        <ul>
        {% for error in form.errors %}
            <li><strong>{{ error|escape }}</strong></li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}

<form action="{% url 'index' %}" method="post">
  {% csrf_token %}

  {% bootstrap_form form %}

  <input type="submit" class="btn btn-primary mb-3" value="Создать">

</form>
    </div>

  <script type="text/javascript">
    
    var tasks_json = JSON.parse('{{tasks_json | safe | escapejs}}');

    let table = document.createElement('table');

    for (const task of tasks_json) {
      const row = table.insertRow(); // добавим строку
      row.classList.add('btn');
      row.classList.add('btn-primary');
      row.classList.add('mb-3');

      let cell1 = row.insertCell(); // добавим ячейки
      let cell2 = row.insertCell();
      let cell3 = row.insertCell();
      cell1.innerHTML = `${task.name} `; // вставим текст
      cell2.innerHTML = "";
      cell2.classList.add("created");
      cell3.classList.add("timer")
    }
    document.body.appendChild(table);

    </script>

<script>
  function startTime() {
    var timers = document.getElementsByClassName("timer");
    i = 0;
    for (let timer of timers) {
      var nowtime = Date.now();
      var created_str = Date.parse(tasks_json[i].timestamp);
      var created = parseInt(created_str)
      var diff = nowtime - created;
      timer.innerHTML = Math.round(diff / 1000);
      i += 1;
    }
    setTimeout(startTime, 1000);
  }
  startTime();
</script>

</main>
    <footer>



    </footer>
<!--<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>-->
<!--      <script>window.jQuery || document.write('<script src="../assets/js/vendor/jquery.slim.min.js"><\/script>')</script><script src="../assets/dist/js/bootstrap.bundle.min.js"></script>-->
</html>
